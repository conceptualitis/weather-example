var React = require('react'),
    router = require('react-router'),
    routes = require('app/routes/client'),
    HtmlComponent = React.createFactory(require('app/components/html'));

module.exports = function (req, res) {
    router.run(routes, req.url, function (element) {
        var Handler = React.createFactory(element);
        res.send(React.renderToStaticMarkup(
            HtmlComponent({
                markup: React.renderToString(Handler({
                    context: req.context.getComponentContext()
                }))
            })
        ));
    });
};
