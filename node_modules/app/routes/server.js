var express = require('express'),
    router = express.Router(),
    request = require('superagent'),
    loadForecast = require('app/actions/load-forecast');

router.get('/', function (req, res, next) {
    res.redirect('/forecasts/today');
});

router.get('/forecasts/:day', function (req, res, next) {
    var payload = {
        day: req.params.day
    };

    req.context.getActionContext().executeAction(loadForecast, payload, function () {
        next();
    });
});

router.get('/api/forecasts/:day', function (req, res, next) {
    request
        .get('http://localhost:8000/' + req.params.day)
        .set('Accept', 'application/json')
        .end(function (data) {
            res.json(data.body);
        });
});

module.exports = router;
